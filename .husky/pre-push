if [ "$(git rev-parse @)" = "$(git rev-parse @{u})" ]; then
    echo "No changes to push."
    exit 0
fi

isStashed=false

if ! git diff-index --quiet HEAD --; then
    git stash push

    isStashed=true
fi

git push --no-verify -u origin "$(git branch --show-current)"

git fetch --tags --force


if [ "$(pnpm lerna diff | wc -l)" -le 0 ]; then
    echo "No changes detected by lerna diff."
    exit 0
fi


echo -e "\033[1;34mRunning lerna version...\033[0m"

pnpm lerna version --yes

if [ "$isStashed" = true ]; then
    git stash pop
fi

git push -f --no-verify

